(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{7909:function(e,t,r){"use strict";r.d(t,{Q:function(){return u},z:function(){return c}});var s=r(5893),a=r(1664),n=r.n(a),o=r(5870),l=r.n(o);let i=(e,t)=>[l().button,l()[e||"primary"],...null!=t?t:[]].join(" "),c=e=>{let{children:t,priority:r,title:a,classes:n,disabled:o,onClick:l}=e;return(0,s.jsx)("button",{className:i(null!=r?r:"primary",n),onClick:l,title:a,disabled:o,children:t})},u=e=>{let{children:t,href:r,title:a,priority:o,classes:l}=e;return(0,s.jsx)(n(),{className:i(null!=o?o:"primary",l),title:a,href:r,children:t})}},9922:function(e,t,r){"use strict";r.d(t,{A:function(){return y}});var s=r(5893),a=r(5299),n=r(6829),o=r.n(n),l=r(7909),i=r(7294);let c=e=>{let t=(0,i.useRef)(null),[r,a]=(0,i.useState)(!1);return(0,s.jsxs)("div",{className:o().prompt,children:[(0,s.jsx)("h1",{children:"A felold\xe1shoz jelsz\xf3 sz\xfcks\xe9ges"}),(0,s.jsxs)("form",{children:[(0,s.jsx)("input",{className:o().input,type:"password",placeholder:"Jelsz\xf3",ref:t}),(0,s.jsx)(l.z,{classes:[o().input],disabled:r,onClick:async r=>{if(!t.current)return;r.preventDefault();let s=t.current.value;a(!0),await e.submit(s),a(!1),t.current&&(t.current.value="")},children:"Felold\xe1s"})]})]})};var u=r(7423);class d{transformStageName(e){return e.replace(/[^a-zA-Z0-9_]/g,"_")}stringifyProgress(e){return e.map(e=>"number"==typeof e?"[".concat(e,"]"):e).join("/")}parseProgress(e){var t,r;let s=/\[([0-9]+)\]/;return null!==(r=null===(t=null==e?void 0:e.split("/"))||void 0===t?void 0:t.map(e=>{let t=e.match(s);return t?Number(t[1]):e}))&&void 0!==r?r:[]}setStorage(e){this.localStorage=e}setKey(e,t){var r;null===(r=this.localStorage)||void 0===r||r.setItem(this.transformStageName(e),t)}getKey(e){var t,r;return null!==(r=null===(t=this.localStorage)||void 0===t?void 0:t.getItem(this.transformStageName(e)))&&void 0!==r?r:null}resetKey(e){var t;null===(t=this.localStorage)||void 0===t||t.removeItem(this.transformStageName(e))}storeProgress(e,t){var r;null===(r=this.localStorage)||void 0===r||r.setItem(this.transformStageName(e)+"_progress",this.stringifyProgress(t))}getProgress(e){var t,r;return this.parseProgress(null!==(r=null===(t=this.localStorage)||void 0===t?void 0:t.getItem(this.transformStageName(e)+"_progress"))&&void 0!==r?r:void 0)}clearProgress(e){var t;return null===(t=this.localStorage)||void 0===t?void 0:t.removeItem(this.transformStageName(e)+"_progress")}checkProgress(e){var t;return!!(null===(t=this.localStorage)||void 0===t?void 0:t.getItem(this.transformStageName(e)+"_progress"))}constructor(){this.localStorage=null}}let g=()=>{let[e,t]=(0,i.useState)(new d);return(0,i.useEffect)(()=>{let e=new d;e.setStorage(window.localStorage),t(e)},[]),e},m=()=>{let[e,t]=(0,i.useState)(0);return[e,()=>t(e+1)]};var p=r(4002),f=r.n(p),_=r(8909);let v=e=>{if("string"==typeof e){let[t,r]=e.split(":");switch(t.toLowerCase()){case"game_over":return{type:"game_over",message:r};case"stage":return{type:"stage",stage:r};default:return console.error('Unknown action: "'.concat(t,'"')),null}}return e},h=e=>({id:e.id,text:e.message,buttons:[]}),x=e=>{let[t,r]=(0,i.useState)(null),[n,o]=(0,i.useState)(!1),c=(0,_.a)("(max-width: 480px)"),[u,d]=m(),p=g(),[x,y]=(0,i.useState)([0]),b=()=>{let t=p.getProgress(e.stage);if(t.length>0){let r="string"==typeof t[0]?e.stagedata.stages.find(e=>e.id==t[0]):e.stagedata.stages[t[0]];if(!r)return;let s=r;e:for(let e of t.slice(1)){let t=v(s.buttons[e].action);switch(null==t?void 0:t.type){case"stage":s=t.stage;break;case"game_over":s=h(t);break e}}return{stage:s,progress:t}}return null},j=()=>{p.storeProgress(e.stage,x)},S=()=>{p.clearProgress(e.stage)},w=()=>{var t,s;let a=null!==(t=e.stagedata.start?e.stagedata.stages.find(t=>t.id==e.stagedata.start):null)&&void 0!==t?t:e.stagedata.stages[0];r(a),y([null!==(s=a.id)&&void 0!==s?s:0])},N=(t,s)=>{let a=v(s);if(a)switch(a.type){case"game_over":a.id?y([a.id]):y([...x,t]),r(h(a));break;case"stage":try{let s="string"==typeof a.stage?e.stagedata.stages.find(e=>e.id==a.stage):a.stage;(null==s?void 0:s.id)?y([s.id]):y([...x,t]),s&&r(s)}catch(e){console.error(e)}}},k=e=>(0,s.jsx)(s.Fragment,{children:e.map((e,r)=>{if(!t||t.buttons.length<=e)return(0,s.jsx)(s.Fragment,{});let n=t.buttons[e];return(0,s.jsx)("button",{className:f().sidebutton,onClick:e=>N(r,n.action),children:(0,s.jsx)(a.D,{children:n.text})},e)})});(0,i.useEffect)(()=>{var s,a,n,l;let i=b();y(null!==(a=null==i?void 0:i.progress)&&void 0!==a?a:[null!==(s=null==t?void 0:t.id)&&void 0!==s?s:0]),r(null!==(l=null!==(n=null==i?void 0:i.stage)&&void 0!==n?n:e.stagedata.start?e.stagedata.stages.find(t=>t.id==e.stagedata.start):null)&&void 0!==l?l:e.stagedata.stages[0]),o(!!i)},[]);let z=(0,i.useMemo)(()=>p.checkProgress(e.stage),[p,u]);return console.log(z,e.stage,p.checkProgress(e.stage)),t&&(0,s.jsxs)("div",{className:f().stage,children:[(0,s.jsx)("div",{className:f().header,children:n?(0,s.jsx)("p",{className:f().progressreminder,children:" Itt hagytad abba legut\xf3bb "}):(0,s.jsx)(s.Fragment,{})}),(0,s.jsx)("div",{className:f().main,children:(0,s.jsxs)("div",{className:f().panels,children:[(0,s.jsx)("div",{className:f().sidepanel,children:c?(0,s.jsx)(s.Fragment,{}):k([0,2])}),(0,s.jsx)("div",{className:f().event_panel,children:(0,s.jsx)(a.D,{children:t.text})}),(0,s.jsx)("div",{className:f().sidepanel,children:k(c?[0,1,2,3]:[1,3])})]})}),(0,s.jsxs)("div",{className:f().footer,children:[(0,s.jsx)(l.z,{classes:[f().footerbutton,f().save],title:"Ment\xe9s",onClick:e=>{j(),d()}}),z?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.z,{classes:[f().footerbutton,f().recyclebin],title:"Ment\xe9s t\xf6rl\xe9se",onClick:e=>{S(),d()}}),(0,s.jsx)(l.z,{classes:[f().footerbutton,f().checkpoint],title:"Előző ment\xe9s \xfajrat\xf6lt\xe9se",onClick:e=>{let t=b();t&&(y(t.progress),r(t.stage))}})]}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(l.z,{classes:[f().footerbutton,f().restart],title:"\xdajrakezd\xe9s",onClick:e=>w()}),(0,s.jsx)(l.Q,{classes:[f().footerbutton,f().home],title:"Főoldal",href:"/"})]})]})},y=e=>{let[t,r]=(0,i.useState)({status:"empty",stage:null}),n=g();(0,i.useEffect)(()=>console.log(t),[t]);let o=async()=>{let t=await e.loader();if("success"!==t.status)return!1;let s=t.stage;if(s.encrypted){let t=n.getKey(e.stage);if(t){let e=await (0,u.K8)(s,t);if(e)return r({status:"ready",stage:e}),!0}return r({status:"loaded",stage:s}),!0}return r({status:"ready",stage:s}),!0};switch((0,i.useEffect)(()=>{e.stage&&o()},[e.stage]),t.status){case"empty":return(0,s.jsx)("div",{className:"prompt",children:(0,s.jsx)(a.D,{children:"Bet\xf6lt\xe9s..."})});case"error":return(0,s.jsx)("div",{className:"prompt",children:(0,s.jsx)(a.D,{children:t.message})});case"loaded":return(0,s.jsx)(c,{submit:async s=>{let a=await (0,u.K8)(t.stage,s);a&&(n.setKey(e.stage,s),r({status:"ready",stage:a}))}});case"ready":try{return(0,s.jsx)(x,{stage:e.stage,stagedata:t.stage})}catch(e){console.error(e),r({status:"error",stage:null,message:"# Hiba t\xf6rt\xe9nt a f\xe1jl olvas\xe1sa k\xf6zben\n\n\n\n\n\nN\xe9zz k\xf6rbe a [főoldalon \uD83D\uDCA7](./)"})}}}},2686:function(e,t,r){"use strict";r.d(t,{BT:function(){return a},tf:function(){return n},yy:function(){return s}});let s=Object.freeze({REGISTRY:"registry.json",SCHEMA:"schema.json",STAGEFILES:"stagefiles"}),a=Object.freeze(["application/json","text/yaml","text/x-yaml","application/x-yaml","text/vnd.yaml"]),n=Object.freeze([".json",".yaml",".yml"])},7423:function(e,t,r){"use strict";r.d(t,{AV:function(){return i},IS:function(){return c},K8:function(){return u},i8:function(){return g},q4:function(){return d}});var s=r(4707),a=r(4360),n=r(8764),o=r(2686);function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.lW.concat([e,n.lW.alloc(Math.max(0,t-e.length),r)])}async function i(e){let t=await fetch(e,{method:"GET",headers:{Accept:o.BT.join(",")}});if(!t.ok)return null;try{var r;return(null===(r=t.headers.get("Content-Type"))||void 0===r?void 0:r.match("application/json"))?await t.json():a.Qc(await t.text())}catch(e){return console.error("Parse error",e),null}}async function c(e){let t=await i(e);return t?{author:t.author,title:t.title}:null}async function u(e,t){if(!0!=e.encrypted)return e;{let r=function(e,t,r){let a=n.lW.from(r),o=a.reduce((e,t)=>e^t),i=l(a.slice(0,16),16,o),c=l(a.slice(16,24),8,o),u=n.lW.from(e,"hex");try{let e=JSON.parse((0,s.pe)(u,i,"cbc",c,!0).toString("utf-8").slice(0,t));return e}catch(e){return console.error("Decrypt error",e),null}}(e.data,e.size,t);return r||null}}function d(e){return new Promise((t,r)=>{let s=new FileReader;s.onload=()=>{var e;let r="string"==typeof s.result?s.result:new TextDecoder().decode(null!==(e=s.result)&&void 0!==e?e:void 0);try{return t(JSON.parse(r))}catch(e){console.error("JSON parse error",e);try{return t(a.Qc(r))}catch(e){return console.error("YAML parse error",e),t(null)}}},s.onabort=r,s.onerror=r,s.readAsText(e,"utf-8")})}function g(e){if("string"!=typeof e)return e;{let t=e.indexOf(":"),[r,s]=[e.substring(0,t),e.substring(t+1)];if(!["game_over","stage","invalid"].includes(r))return{type:"invalid"};switch(r){case"invalid":default:return{type:"invalid"};case"game_over":return{type:"game_over",message:s};case"stage":return{type:"stage",stage:s}}}}},8909:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});var s=r(7294);let a=e=>{let[t,r]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let t=window.matchMedia(e),s=e=>r(e.matches);return t.addEventListener("change",s),()=>t.removeEventListener("change",s)},[]),t}},5870:function(e){e.exports={button:"button_button__qrSvw",primary:"button_primary__e2_Sy",secondary:"button_secondary__DAail",tetriary:"button_tetriary__rvrGd"}},6829:function(e){e.exports={prompt:"prompt_prompt__XPEqH",input:"prompt_input__CD0FL",invalid:"prompt_invalid__taS4w"}},4002:function(e){e.exports={sidebutton:"stagecomponent_sidebutton__9doHp",stage_preview:"stagecomponent_stage_preview__3OaVD",stages:"stagecomponent_stages__jTJTb",panels:"stagecomponent_panels__pepWV",sidepanel:"stagecomponent_sidepanel___IERi",stage:"stagecomponent_stage__MYFSp",header:"stagecomponent_header__C3I9b",footer:"stagecomponent_footer__ikKd_",main:"stagecomponent_main__1DWU6",event_panel:"stagecomponent_event_panel__eI_KM",progressreminder:"stagecomponent_progressreminder__LP1QB",footerbutton:"stagecomponent_footerbutton__0mZpB",checkpoint:"stagecomponent_checkpoint__sMEO0",recyclebin:"stagecomponent_recyclebin__nwqzy",save:"stagecomponent_save__FtmqK",restart:"stagecomponent_restart__xJNMo",home:"stagecomponent_home__OGIqV"}}}]);